<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>구매대행 판매가 계산기</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#2563eb">
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<style>
  :root{ --border:#e5e7eb; --text:#111827; --muted:#6b7280; --bg:#ffffff; --chip:#f3f4f6; }
  *{box-sizing:border-box}
  body { font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",Arial,sans-serif; margin:20px; color:var(--text); background:var(--bg); }
  h1 { font-size:22px; margin:2px 0 12px; }
  .card { border:1px solid var(--border); border-radius:14px; padding:14px; margin-bottom:16px; background:#fff; box-shadow:0 1px 2px rgba(0,0,0,0.02); }
  .row { display:flex; gap:12px; flex-wrap:wrap; }
  .field { flex:1 1 220px; min-width:220px; }
  label { display:block; font-weight:600; margin-bottom:6px; }
  input[type="number"] { width:100%; padding:12px; border:1px solid #d1d5db; border-radius:10px; font-size:16px; background:#fff; }
  .muted { color:var(--muted); font-size:12px; }
  .result { font-size:18px; font-weight:700; }
  .mono { font-variant-numeric:tabular-nums; letter-spacing:0.2px; }
  .total-wrap{ position:relative; border-radius:16px; padding:16px; overflow:hidden; }
  .total-wrap::before{ content:""; position:absolute; inset:-1px; border-radius:18px; background:linear-gradient(135deg, rgba(37,99,235,.12), rgba(124,58,237,.12)); z-index:0; }
  .total { position:relative; z-index:1; background:#fff; border-radius:12px; padding:14px; border:1px dashed rgba(99,102,241,.45) }
  .big { font-size:28px; font-weight:900; margin:4px 0 10px; }
  .btn { padding:10px 14px; border:1px solid var(--border); border-radius:10px; background:#fafafa; cursor:pointer; }
  .btn:active{ transform:translateY(1px); }
  .panel{ display:none; margin-top:12px; }
  .grid { display:grid; grid-template-columns:1fr auto; gap:8px 12px; align-items:center; }
  .right { text-align:right; }
  .select,input[type="number"]{ background:#fff; }
</style>
</head>
<body>
  <h1>구매대행 판매가 계산기</h1>

  <div class="card">
    <div class="row">
      <div class="field">
        <label>제품가 (USD)</label>
        <input id="price_usd" type="number" min="0" step="0.01" value="39" />
      </div>
      <div class="field">
        <label>국제 배송비 (KRW)</label>
        <input id="shipping_krw" type="number" min="0" step="1" value="20000" />
      </div>
    </div>
    <div class="total-wrap" style="margin-top:12px;">
      <div class="total">
        <div style="display:flex; align-items:center; justify-content:space-between;">
          <div style="font-weight:700;">최종 소비자가 <span class="muted">(부가세 포함)</span></div>
          <button class="btn" onclick="togglePanel('breakdown')">자세히 보기</button>
        </div>
        <div class="big mono" id="r6">-</div>
      </div>
    </div>
    <div class="panel" id="breakdown">
      <div class="grid" style="margin-top:12px;">
        <div>① 원화 환산 (USD×환율)</div><div id="r1" class="result mono right">-</div>
        <div>② 미국 세금 포함 (①×(1+미국세))</div><div id="r2" class="result mono right">-</div>
        <div>③ 배송비 포함 (② + 배송비)</div><div id="r3" class="result mono right">-</div>
        <div>④ 마진 적용 (③×(1+마진))</div><div id="r4" class="result mono right">-</div>
        <div>⑤ 플랫폼 수수료 적용 (④×(1+수수료))</div><div id="r5" class="result mono right">-</div>
      </div>
      <div class="muted" style="margin-top:8px;">공식: ((USD×환율)×(1+미국세) + 배송비) × (1+마진) × (1+수수료) × (1+부가세)</div>
    </div>
    <div style="margin-top:12px;">
      <button class="btn" onclick="togglePanel('advanced')">고급 설정 열기</button>
    </div>
    <div class="panel" id="advanced">
      <div class="row" style="margin-top:12px;">
        <div class="field">
          <label>환율 (KRW/1 USD)</label>
          <input id="fx" type="number" min="500" step="1" value="1400">
        </div>
        <div class="field">
          <label>미국 세율</label>
          <input id="us_tax" type="number" min="0" max="1" step="0.01" value="0.10">
        </div>
        <div class="field">
          <label>마진율</label>
          <input id="margin" type="number" min="0" max="1" step="0.01" value="0.30">
        </div>
        <div class="field">
          <label>플랫폼 수수료율</label>
          <input id="fee" type="number" min="0" max="1" step="0.01" value="0.15">
        </div>
        <div class="field">
          <label>한국 부가세</label>
          <input id="vat" type="number" min="0" max="1" step="0.01" value="0.10">
        </div>
        <div class="field">
          <label>반올림</label>
          <select id="rounding" class="select">
            <option value="1">없음</option>
            <option value="100" selected>100원 단위</option>
            <option value="1000">1,000원 단위</option>
          </select>
        </div>
      </div>
    </div>
  </div>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
  });
}
function fmtKRW(n){ if (isNaN(n)) return "-"; return new Intl.NumberFormat('ko-KR', { maximumFractionDigits: 0 }).format(Math.round(n)) + "원"; }
function roundTo(n, unit){ if(!unit || unit===1) return n; return Math.round(n / unit) * unit; }
function val(id){ const el = document.getElementById(id); const v = parseFloat(el.value); return isNaN(v) ? 0 : v; }
function togglePanel(id){
  const el = document.getElementById(id);
  el.style.display = (el.style.display === 'none' || el.style.display === '') ? 'block' : 'none';
}
function compute(){
  const priceUSD = val('price_usd');
  const shipping = val('shipping_krw');
  const fx = document.getElementById('fx') ? val('fx') : 1400;
  const usTax = document.getElementById('us_tax') ? val('us_tax') : 0.10;
  const margin = document.getElementById('margin') ? val('margin') : 0.30;
  const fee = document.getElementById('fee') ? val('fee') : 0.15;
  const vat = document.getElementById('vat') ? val('vat') : 0.10;
  const rounding = document.getElementById('rounding') ? parseInt(document.getElementById('rounding').value) : 100;

  const r1 = priceUSD * fx;
  const r2 = r1 * (1 + usTax);
  const r3 = r2 + shipping;
  const r4 = r3 * (1 + margin);
  const r5 = r4 * (1 + fee);
  let r6 = r5 * (1 + vat);
  r6 = roundTo(r6, rounding);

  const S = id=>document.getElementById(id);
  if(S('r1')) S('r1').textContent = fmtKRW(r1);
  if(S('r2')) S('r2').textContent = fmtKRW(r2);
  if(S('r3')) S('r3').textContent = fmtKRW(r3);
  if(S('r4')) S('r4').textContent = fmtKRW(r4);
  if(S('r5')) S('r5').textContent = fmtKRW(r5);
  if(S('r6')) S('r6').textContent = fmtKRW(r6);
}
['price_usd','shipping_krw'].forEach(id=>{
  document.getElementById(id).addEventListener('input', compute);
});
document.addEventListener('input', (e)=>{
  if(['fx','us_tax','margin','fee','vat','rounding'].includes(e.target.id)) compute();
});
window.addEventListener('DOMContentLoaded', compute);
</script>
</body>
</html>
